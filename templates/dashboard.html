<!DOCTYPE html>
<html lang="en">
<div style="display:none;">{% load static %}</div>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Student Dashboard</title>

    <!-- Modern Typography -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Advanced Dashboard Styles -->
    <link rel="stylesheet" href="{% static 'stylesheets/advanced_dashboard.css' %}">

    <!-- React & Babel Standalone (for TSX execution) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Boxicons -->
    <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>

    <script>
        (function () {
            if (window.location.hostname === '127.0.0.1' || window.location.hostname === 'localhost') {
                if (window.location.port !== '8000' && window.location.port !== '') {
                    window.location.replace(window.location.protocol + '//' + window.location.hostname + ':8000/dashboard/');
                }
            }
        })();
    </script>
</head>

<body>
    <div id="root">
        <!-- Loader / Fallback -->
        <div
            style="height: 100vh; display: flex; align-items: center; justify-content: center; background: #1e293b; color: white; font-family: 'Outfit', sans-serif;">
            <div style="text-align: center;">
                <div
                    style="width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.1); border-top-color: #818cf8; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;">
                </div>
                <h2>Initializing Dashboard...</h2>
            </div>
        </div>
    </div>

    <style>
        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.4);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at center, rgba(235, 245, 255, 1) 0%, transparent 70%);
            opacity: 0.5;
            pointer-events: none;
        }

        .card-value {
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            letter-spacing: -0.5px;
        }

        .action-btn {
            border: 1px solid rgba(0, 0, 0, 0.05) !important;
        }

        @keyframes pulse-glow {
            0% {
                box-shadow: 0 0 0 0 rgba(79, 70, 229, 0.4);
            }

            70% {
                box-shadow: 0 0 0 15px rgba(79, 70, 229, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(79, 70, 229, 0);
            }
        }

        .active-status {
            animation: pulse-glow 2s infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>

    <script>
        // Data injected from Django to React
        window.CUR_USER = "{{ user.username }}";
        window.STATUS_DATA = {
            counseling: "{{ counseling_status }}",
            grievance: "{{ grievance_status }}"
        };
        window.URLS = {
            'status': "{% url 'approval_status' %}",
            'counseling': "{% url 'counseling_form' %}",
            'profile': "{% url 'profile' %}",
            'grievance': "{% url 'grievance_form' %}",
            'history': "{% url 'grievance_status' %}",
            'logout': "{% url 'logout' %}"
        };
    </script>

    <!-- Load the React Dashboard App -->
    {% verbatim %}
    <script type="text/babel">
        // Mock React Component for Dashboard
        const DashboardApp = () => {
            const getColor = (status) => {
                const s = status.toLowerCase();
                if (s.includes('approved') || s.includes('resolved')) return '#10b981';
                if (s.includes('pending') || s.includes('progress')) return '#f59e0b';
                if (s.includes('no') || s.includes('not')) return '#94a3b8';
                return '#ef4444';
            };

            const menuItems = [
                { id: 'status', label: 'Approval Status', icon: 'check-shield', color: 'bg-purple', href: 'status_url' },
                { id: 'counseling', label: 'Counseling Form', icon: 'edit', color: 'bg-blue', href: 'form_url' },
                { id: 'grievance', label: 'Submit Grievance', icon: 'message-error', color: 'bg-rose', href: 'grievance_url' },
                { id: 'history', label: 'Grievance History', icon: 'check-circle', color: 'bg-emerald', href: 'history_url' },
            ];

            return (
                <div className="dashboard-layout">
                    {/* Sidebar */}
                    <aside className="sidebar">
                        <div className="logo">
                            <box-icon name='rocket' type='solid' color='#818cf8'></box-icon>
                            <span>NBKRIST</span>
                        </div>

                        <nav className="nav-links">
                            <div className="nav-item">
                                <a href="#" className="nav-link active">
                                    <box-icon name='grid-alt' color="white"></box-icon>
                                    <span>Dashboard</span>
                                </a>
                            </div>
                            <div className="nav-item">
                                <a href={window.URLS['profile']} className="nav-link">
                                    <box-icon name='user-detail' color="#94a3b8"></box-icon>
                                    <span>Profile</span>
                                </a>
                            </div>

                            <div className="nav-item" style={{ marginTop: 'auto' }}>
                                <a href={window.URLS['logout']} className="nav-link logout-link-sidebar">
                                    <box-icon name='log-out' color="#ef4444"></box-icon>
                                    <span>Logout</span>
                                </a>
                            </div>
                        </nav>
                    </aside>

                    {/* Main Content */}
                    <main className="main-content">
                        <header className="header">
                            <div className="welcome-section">
                                <h1>Hi, {window.CUR_USER || 'Student'}! ðŸ‘‹</h1>
                                <p>Welcome to your academic counseling portal.</p>
                            </div>

                            <div className="profile-chip">
                                <div className="avatar">{(window.CUR_USER || 'S')[0]}</div>
                                <span>{window.CUR_USER || 'Student'}</span>
                            </div>
                        </header>

                        <div className="stats-grid" style={{ gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))' }}>
                            <div className={`stat-card ${!window.STATUS_DATA.grievance.toLowerCase().includes('no') ? 'active-status' : ''}`}>
                                <div className="card-title">Grievance Status</div>
                                <div className="card-value" style={{ color: getColor(window.STATUS_DATA.grievance) }}>
                                    {window.STATUS_DATA.grievance}
                                </div>
                            </div>
                            <div className={`stat-card ${!window.STATUS_DATA.counseling.toLowerCase().includes('not') ? 'active-status' : ''}`}>
                                <div className="card-title">Counseling Status</div>
                                <div className="card-value" style={{ color: getColor(window.STATUS_DATA.counseling) }}>
                                    {window.STATUS_DATA.counseling}
                                </div>
                            </div>
                        </div>

                        <div className="quick-actions">
                            {menuItems.map(item => (
                                <a key={item.id} href={window.URLS[item.id]} className="action-btn">
                                    <div className={`icon-wrapper ${item.color}`}>
                                        <box-icon name={item.icon} type='solid' color='white' size='md'></box-icon>
                                    </div>
                                    <span>{item.label}</span>
                                </a>
                            ))}
                        </div>
                    </main>
                </div>
            );
        };

        // Render the application once everything is ready
        window.addEventListener('load', () => {
            if (typeof ReactDOM !== 'undefined') {
                const root = ReactDOM.createRoot(document.getElementById('root'));
                root.render(<DashboardApp />);
            }
        });
    </script>
    {% endverbatim %}

</body>

</html>